{
  "anonymous": false,
  "attributes": [
    {
      "name": "Approver",
      "values": [
        ""
      ]
    },
    {
      "name": "Version Tag",
      "values": [
        "1-0-0-RC-3"
      ]
    }
  ],
  "bridgedResources": [
    {
      "model": "Staging DB - People",
      "name": "Staging DB Person Search",
      "order": [

      ],
      "parameters": [
        {
          "mapping": "${values('search-typeahead')}%",
          "name": "Email "
        },
        {
          "mapping": "${values('search-typeahead')}%",
          "name": "First Name"
        },
        {
          "mapping": "${values('search-typeahead')}%",
          "name": "Id"
        },
        {
          "mapping": "${values('search-typeahead')}%",
          "name": "Last Name"
        }
      ],
      "qualification": "Like First Name - Last Name - Email or Id",
      "status": "Active"
    },
    {
      "model": "Staging DB - People",
      "name": "Staging DB Person Search by Id",
      "order": [

      ],
      "parameters": [
        {
          "mapping": "${identity('username')}",
          "name": "id"
        }
      ],
      "qualification": "By Id",
      "status": "Active"
    }
  ],
  "categorizations": [

  ],
  "customHeadContent": "",
  "description": "Sub Form Template to hold Requested For Section. In this example it shows a different search style using type ahead.",
  "indexDefinitions": [
    {
      "name": "closedBy",
      "parts": [
        "closedBy"
      ],
      "unique": false
    },
    {
      "name": "createdBy",
      "parts": [
        "createdBy"
      ],
      "unique": false
    },
    {
      "name": "handle",
      "parts": [
        "handle"
      ],
      "unique": false
    },
    {
      "name": "submittedBy",
      "parts": [
        "submittedBy"
      ],
      "unique": false
    },
    {
      "name": "type,coreState,createdBy",
      "parts": [
        "type",
        "coreState",
        "createdBy"
      ],
      "unique": false
    },
    {
      "name": "type,coreState,submittedBy",
      "parts": [
        "type",
        "coreState",
        "submittedBy"
      ],
      "unique": false
    },
    {
      "name": "type,createdBy",
      "parts": [
        "type",
        "createdBy"
      ],
      "unique": false
    },
    {
      "name": "type,submittedBy",
      "parts": [
        "type",
        "submittedBy"
      ],
      "unique": false
    },
    {
      "name": "updatedBy",
      "parts": [
        "updatedBy"
      ],
      "unique": false
    },
    {
      "name": "values[Company]",
      "parts": [
        "values[Company]"
      ],
      "unique": false
    },
    {
      "name": "values[Cost Code]",
      "parts": [
        "values[Cost Code]"
      ],
      "unique": false
    },
    {
      "name": "values[Email]",
      "parts": [
        "values[Email]"
      ],
      "unique": false
    },
    {
      "name": "values[Phone]",
      "parts": [
        "values[Phone]"
      ],
      "unique": false
    },
    {
      "name": "values[Request For]",
      "parts": [
        "values[Request For]"
      ],
      "unique": false
    },
    {
      "name": "values[Requested For Display Name]",
      "parts": [
        "values[Requested For Display Name]"
      ],
      "unique": false
    },
    {
      "name": "values[Requested For Id]",
      "parts": [
        "values[Requested For Id]"
      ],
      "unique": false
    },
    {
      "name": "values[Responsible Company]",
      "parts": [
        "values[Responsible Company]"
      ],
      "unique": false
    },
    {
      "name": "values[Review Mode]",
      "parts": [
        "values[Review Mode]"
      ],
      "unique": false
    },
    {
      "name": "values[search-typeahead]",
      "parts": [
        "values[search-typeahead]"
      ],
      "unique": false
    }
  ],
  "integrations": [

  ],
  "name": "Requested For Search",
  "notes": null,
  "pages": [
    {
      "advanceCondition": null,
      "displayCondition": null,
      "displayPage": null,
      "elements": [
        {
          "type": "section",
          "renderType": null,
          "name": "requested-for-container",
          "title": "",
          "visible": true,
          "omitWhenHidden": null,
          "renderAttributes": {
          },
          "elements": [
            {
              "type": "section",
              "renderType": null,
              "name": "requested-for-choice-section",
              "title": "",
              "visible": true,
              "omitWhenHidden": null,
              "renderAttributes": {
              },
              "elements": [
                {
                  "type": "field",
                  "name": "Request For",
                  "label": "This Request is For",
                  "key": "f1",
                  "defaultValue": "Me",
                  "defaultResourceName": null,
                  "visible": "values('Review Mode')!==\"true\"",
                  "enabled": true,
                  "required": false,
                  "requiredMessage": null,
                  "omitWhenHidden": false,
                  "pattern": null,
                  "constraints": [

                  ],
                  "events": [
                    {
                      "name": "Set to Me",
                      "type": "Change",
                      "action": "Custom",
                      "code": "$('#person-select .rbt-input').val(\"\")\nK('field[Requested For Id]').value( resource['Id'] );\nK('field[Requested For Display Name]').value( resource['Display Name'] );\nK('field[Phone]').value( resource['Phone'] );\nK('field[Email]').value( resource['Email'] );\nK('field[Company]').value( resource['Company'] );\nK('field[Responsible Company]').value( resource['Responsible Company'] );\nsetDisplayPerson();",
                      "runIf": "values('Request For')=='Me'",
                      "bridgedResourceName": "Staging DB Person Search by Id",
                      "mappings": [
                        {
                          "field": "Requested For Display Name",
                          "value": "${resources('Staging DB Person Search by Id:Display Name')}",
                          "visible": true
                        },
                        {
                          "field": "Requested For Id",
                          "value": "${resources('Staging DB Person Search by Id:Id')}",
                          "visible": true
                        },
                        {
                          "field": "Email",
                          "value": "${resources('Staging DB Person Search by Id:Email')}",
                          "visible": true
                        },
                        {
                          "field": "Phone",
                          "value": "${resources('Staging DB Person Search by Id:Phone')}",
                          "visible": true
                        },
                        {
                          "field": "Company",
                          "value": "${resources('Staging DB Person Search by Id:Company')}",
                          "visible": true
                        },
                        {
                          "field": "Responsible Company",
                          "value": "${resources('Staging DB Person Search by Id:Responsible Company')}",
                          "visible": true
                        }
                      ]
                    },
                    {
                      "name": "Set to Someone Else",
                      "type": "Change",
                      "action": "Custom",
                      "code": "clearPerson();\nsetDisplayPerson();",
                      "runIf": "values('Request For')=='Someone Else'"
                    },
                    {
                      "name": "Check Same as Requester in POC",
                      "type": "Change",
                      "action": "Custom",
                      "code": "var POCForm = Kinetic.forms[ $('body').find('div [data-element-name=\"Same as Requester\"]').closest('form').attr('id') ];\nif ( POCForm ) { POCForm.getFieldByName('Same as Requester').value( null) }\n"
                    }
                  ],
                  "renderAttributes": {
                  },
                  "dataType": "string",
                  "renderType": "radio",
                  "choicesResourceName": null,
                  "choicesRunIf": null,
                  "choices": [
                    {
                      "label": "Me",
                      "value": "Me"
                    },
                    {
                      "label": "Someone Else",
                      "value": "Someone Else"
                    }
                  ]
                }
              ]
            },
            {
              "type": "section",
              "renderType": null,
              "name": "search-section",
              "title": null,
              "visible": "values('Request For') === \"Someone Else\" && values('Review Mode') !== \"true\"",
              "omitWhenHidden": true,
              "renderAttributes": {
                "class": "form-group__columns"
              },
              "elements": [
                {
                  "type": "content",
                  "renderType": "html",
                  "name": "typeahead-instructions-html",
                  "text": "",
                  "visible": true,
                  "renderAttributes": {
                  }
                },
                {
                  "type": "field",
                  "name": "search-typeahead",
                  "label": "",
                  "key": "f20",
                  "defaultValue": null,
                  "defaultResourceName": null,
                  "visible": true,
                  "enabled": true,
                  "required": false,
                  "requiredMessage": null,
                  "omitWhenHidden": null,
                  "pattern": null,
                  "constraints": [

                  ],
                  "events": [

                  ],
                  "renderAttributes": {
                    "uses-typeahead": "yes",
                    "typeahead-fa-class": "null",
                    "typeahead-attribute-to-set": "Display Name",
                    "typeahead-bridged-resource": "Staging DB Person Search",
                    "typeahead-attributes-to-show": "Display Name,Phone,Email,Id,Company,Responsible Company",
                    "typeahead-placeholder": "Search for Person by HID or Last Name",
                    "typeahead-fields-to-set": "Requested For Display Name=Display Name,Email=Email,Cost Code=Cost Code,Requested For Id=Id,Phone=Phone,Company=Company,Responsible Company=Responsible Company",
                    "typeahead-user-id-attribute": "Id"
                  },
                  "dataType": "string",
                  "renderType": "text",
                  "rows": 1
                }
              ]
            },
            {
              "type": "section",
              "renderType": null,
              "name": "person-details-section",
              "title": null,
              "visible": "values('Request For') != null",
              "omitWhenHidden": true,
              "renderAttributes": {
              },
              "elements": [
                {
                  "type": "content",
                  "renderType": "html",
                  "name": "person-details-container-html",
                  "text": "<div id=\"meDetails\">\n  <div id=\"requestedFor\">\n    <dt id=\"dt_name\">Name:</dt>  <dd id=\"dd_name\"></dd>\n    <dt id=\"dt_phone\">Phone:</dt>  <dd id=\"dd_phone\"></dd>\n    <dt id=\"dt_email\">Email:</dt>  <dd id=\"dd_email\"></dd>\n  </div>\n</div>\n",
                  "visible": true,
                  "renderAttributes": {
                  }
                }
              ]
            }
          ]
        },
        {
          "type": "section",
          "renderType": null,
          "name": "Hidden Section",
          "title": null,
          "visible": false,
          "omitWhenHidden": false,
          "renderAttributes": {
          },
          "elements": [
            {
              "type": "field",
              "name": "Requested For Display Name",
              "label": "Requested For Display Name",
              "key": "f14",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Requested For Id",
              "label": "Requested For Id",
              "key": "f15",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": true,
              "requiredMessage": "Please selected a who the Request is for",
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Email",
              "label": "Email",
              "key": "f9",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": false,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Phone",
              "label": "Phone",
              "key": "f21",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Company",
              "label": "Company",
              "key": "f23",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Responsible Company",
              "label": "Responsible Company",
              "key": "f22",
              "defaultValue": "",
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Cost Code",
              "label": "Cost Code",
              "key": "f24",
              "defaultValue": null,
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            },
            {
              "type": "field",
              "name": "Review Mode",
              "label": "Review Mode",
              "key": "f19",
              "defaultValue": null,
              "defaultResourceName": null,
              "visible": true,
              "enabled": true,
              "required": false,
              "requiredMessage": null,
              "omitWhenHidden": null,
              "pattern": null,
              "constraints": [

              ],
              "events": [

              ],
              "renderAttributes": {
              },
              "dataType": "string",
              "renderType": "text",
              "rows": 1
            }
          ]
        }
      ],
      "events": [
        {
          "name": "onLoad",
          "type": "Load",
          "action": "Custom",
          "code": "setDisplayPerson = function(){\n      $('#dd_name').text( K('field[Requested For Display Name]').value() )\n      $('#dd_phone').text( K('field[Phone]').value() )\n      $('#dd_email').text( K('field[Email]').value() )\n  }   \n\n  clearPerson = function(){\n    K('field[Requested For Id]').value(null);\n    K('field[Requested For Display Name]').value(null);  \n    K('field[Email]').value(null);\n    K('field[Phone]').value(null);    \n    K('field[Company]').value(null);\n    K('field[Responsible Company]').value(null);\n    K('field[Cost Code]').value(null);\n    setDisplayPerson();\n  }   \n\n// setTimeout is a workaround to KCORE-2962.  The work around allows the watch fields to be set in the K.load loaded callback before the fields are set.  \nsetTimeout(function(){ \n  // Logic for when parent is loaded in review mode.\n  if ( K('field[Review Mode]').value() == \"true\" ) {\n    $(K('form').element()).find(':input:not(:disabled)').prop('disabled',true);\n    //K('section[search-section]').hide();\n    //K('field[Request For]').hide();\n  }\n  else if (K('field[Request For]').value() == \"Me\"){ \n    if (K('field[Requested For Id]').value()==null) K('field[Requested For Id]').value(K('identity').username);\n    if (K('field[Requested For Display Name]').value() ==null)  K('field[Requested For Display Name]').value(K('identity').displayName);\n    if (resource !== null) {\n      if (K('field[Email]').value() ==null)  K('field[Email]').value( resource['Email'] );\n      if (K('field[Phone]').value()==null) K('field[Phone]').value( resource['Phone'] );\n      if (K('field[Company]').value()==null) K('field[Company]').value( resource['Company'] );\n      if (K('field[Responsible Company]').value()==null) K('field[Responsible Company]').value( resource['Responsible Company'] );    \n      if (K('field[Cost Code]').value()==null) K('field[Cost Code]').value( resource['Cost Code'] );\n    }\n  }\n  setDisplayPerson();\n}, 1000);",
          "runIf": "",
          "bridgedResourceName": "Staging DB Person Search by Id"
        },
        {
          "name": "Initialize Typeahead",
          "type": "Load",
          "action": "Custom",
          "code": "typeAheadSearch( K('form') );\n// Bind an additional event to typeahead select\n$(K('field[search-typeahead]').element()).bind('typeahead:select', function(ev, suggestion) {\n  // Render the Callback Sepecified in the Configuration\n  setDisplayPerson();\n  $(this).typeahead('val','');\n});\n",
          "bridgedResourceName": null,
          "runIf": ""
        }
      ],
      "name": "requested-for-information",
      "renderType": "submittable",
      "type": "page"
    }
  ],
  "securityPolicies": [
    {
      "endpoint": "Display",
      "name": "Everyone"
    }
  ],
  "slug": "requested-for-search",
  "status": "Active",
  "submissionLabelExpression": "",
  "type": "Template - Subform"
}